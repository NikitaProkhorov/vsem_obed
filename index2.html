<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<link href="https://unpkg.com/simplebar/dist/simplebar.min.css" rel="stylesheet">
	<title>Всем обед</title>
	
</head>

<body>
	<div class="container">

		<div class="scroll" onmousedown='grab(this)' id="dateScroll">
			<!-- Динамические даты будут здесь -->
		</div>


		<div class="text-cont">
				<h3 class="zag">Основные блюда</h3>
				<p class="text">Мы предлагаем вам самые свежие и вкусные блюда, которые точно порадуют вас и ваших близких!</p>
		</div>

		<div class="inner" id="menuItems">
			<!-- Элементы меню будут добавлены здесь динамически -->
		</div>
		
		<!-- <div class="inner">
			<div class="item" onclick="openNewPage('page_url_1')">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Свиные ребра в пивной глазури</h4>
				<p class="desc">Свиные ребра в пивной глазури с салотом из чего-то</p>
				<div class="but"> 
					<button class="btn" id="btn1">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Каша рисовая</h4>
				<p class="desc">Рис, молоко, масло сливочное</p>
				<div class="but"> 
					<button class="btn" id="btn2">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Куриный суп</h4>
				<p class="desc">Куриное филе, лук, морковь, лапша</p>
				<div class="but"> 
					<button class="btn" id="btn3">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Печень в сливочном соусе</h4>
				<p class="desc">Печень куриная, сливки, лук, чеснок</p>
				<div class="but"> 
					<button class="btn" id="btn4">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Курица в соусе терияки</h4>
				<p class="desc">Куриное филе, перец болг, кунжут, лук зеленый, соус терияки</p>
				<div class="but"> 
					<button class="btn" id="btn5">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Рис с овощами</h4>
				<p class="desc">Рис, морковь, кукуруза</p>
				<div class="but"> 
					<button class="btn" id="btn6">Add</button>
				</div>
			</div>
		</div>

		<div class="text-cont2">
			<h3 class="zag">Дополнительно</h3>
			<p class="text">Всё необходимое для вкусного перекуса на обеде!</p>
		</div>

		<div class="inner">
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Свиные ребра в пивной глазури</h4>
				<p class="desc">Свиные ребра в пивной глазури с салотом из чего-то</p>
				<div class="but"> 
					<button class="btn" id="btn7">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Каша рисовая</h4>
				<p class="desc">Рис, молоко, масло сливочное</p>
				<div class="but"> 
					<button class="btn" id="btn8">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Куриный суп</h4>
				<p class="desc">Куриное филе, лук, морковь, лапша</p>
				<div class="but"> 
					<button class="btn" id="btn9">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Печень в сливочном соусе</h4>
				<p class="desc">Печень куриная, сливки, лук, чеснок</p>
				<div class="but"> 
					<button class="btn" id="btn10">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Курица в соусе терияки</h4>
				<p class="desc">Куриное филе, перец болг, кунжут, лук зеленый, соус терияки</p>
				<div class="but"> 
					<button class="btn" id="btn11">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Рис с овощами</h4>
				<p class="desc">Рис, морковь, кукуруза</p>
				<div class="but"> 
					<button class="btn" id="btn12">Add</button>
				</div>
			</div>
		</div> -->

		<!-- <div class="text-cont2">
			<h3 class="zag">Дополнительно</h3>
			<p class="text">Всё необходимое для вкусного перекуса на обеде!</p>
		</div>

		<div class="inner">
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Свиные ребра в пивной глазури</h4>
				<p class="desc">Свиные ребра в пивной глазури с салотом из чего-то</p>
				<div class="but"> 
					<button class="btn" id="btn13">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Каша рисовая</h4>
				<p class="desc">Рис, молоко, масло сливочное</p>
				<div class="but"> 
					<button class="btn" id="btn14">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Куриный суп</h4>
				<p class="desc">Куриное филе, лук, морковь, лапша</p>
				<div class="but"> 
					<button class="btn" id="btn15">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Печень в сливочном соусе</h4>
				<p class="desc">Печень куриная, сливки, лук, чеснок</p>
				<div class="but"> 
					<button class="btn" id="btn16">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="1.jpg" alt="" class="img">
				<h4 class="name">Курица в соусе терияки</h4>
				<p class="desc">Куриное филе, перец болг, кунжут, лук зеленый, соус терияки</p>
				<div class="but"> 
					<button class="btn" id="btn17">Add</button>
				</div>
			</div>
			<div class="item">
				<img src="2.jpg" alt="" class="img">
				<h4 class="name">Рис с овощами</h4>
				<p class="desc">Рис, морковь, кукуруза</p>
				<div class="but"> 
					<button class="btn" id="btn18">Add</button>
				</div>
			</div>
		</div> -->

	</div>
	

	<script src="https://unpkg.com/simplebar/dist/simplebar.min.js"></script>
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script src="app.js"></script>

	<script>
		const startDate = new Date("2023-12-04"); // Задайте дату начала индексации
		let currentIndex = 1;
		let currentDate = new Date();

		while (startDate < currentDate) {
		if (startDate.getDay() !== 0 && startDate.getDay() !== 6) { // Пропускаем выходные
			currentIndex = (currentIndex % 20) + 1; // Обновляем индекс с учетом перехода на следующую "неделю"
		}
		startDate.setDate(startDate.getDate() + 1);
		}

		const dateScrollContainer = document.getElementById('dateScroll');
		const daysInWeek = 5; // Рабочие дни с понедельника по пятницу
		const totalDays = 30; // Всего рабочих дней для отображения
		const days = ["Пн", "Вт", "Ср", "Чт", "Пт"];

		for (let i = 0; i < totalDays; i++) {
		const dayOfWeek = startDate.getDay();

		if (dayOfWeek >= 1 && dayOfWeek <= 5) { // Работаем только с понедельником-пятницей
			const newDateElement = document.createElement('div');
			newDateElement.classList.add('card');
			
			const formattedDate = `${days[dayOfWeek - 1]} ${('0' + startDate.getDate()).slice(-2)}.${('0' + (startDate.getMonth() + 1)).slice(-2)}.${String(startDate.getFullYear()).slice(-2)}`;

			newDateElement.innerHTML = `<h2>${formattedDate}</h2>`;
			newDateElement.setAttribute('id', currentIndex); // Устанавливаем id кнопки
			
			// Добавляем обработчик события для нажатия на элемент card
			newDateElement.addEventListener('click', function() {
			const prevSelectedDateElement = document.querySelector('.selected');
			if (prevSelectedDateElement) {
				prevSelectedDateElement.classList.remove('selected'); // Снимаем выделение с предыдущей выбранной даты
			}
			this.classList.add('selected'); // Выделяем новую дату
			// alert(`Идентификатор дня: ${this.id}`); // Выводим сообщение с индентификатором дня
			});
			
			dateScrollContainer.appendChild(newDateElement);
			currentIndex = (currentIndex % 20) + 1; // Обновляем индекс с учетом перехода на следующую "неделю"
		}
		startDate.setDate(startDate.getDate() + 1);
		}
	</script>

	<script>
		// Функция для запроса меню из базы данных по выбранной дате (индексу)
		function fetchMenu(dayId) {
			const menuItemsContainer = document.getElementById('menuItems');
    		menuItemsContainer.innerHTML = ''; // Очищаем контейнер перед загрузкой нового меню
			
			fetch(`http://127.0.0.1:5000/get_menu/${dayId}`)
				.then(response => {
					console.log(response); // Вывод объекта ответа в консоль
					if (!response.ok) {
						throw new Error('Network response was not ok.');
					}
					return response.json();
				})
				.then(menuData => {
					console.log(menuData); // Вывод данных в консоль
					const items = document.querySelectorAll('.item');

					const menuItemsContainer = document.getElementById('menuItems'); // Получаем контейнер для меню

					if (menuData.menu && menuData.menu.length > 0) {
						menuData.menu.forEach((menuItem, index) => {
							// Создаем элементы .item для каждого блюда
							const newItem = document.createElement('div');
							newItem.classList.add('item');
							newItem.setAttribute('onclick', "openNewPage('prod.html')");
							
							const photoElement = document.createElement('img');
							photoElement.classList.add('img');
							photoElement.src = '1.jpg';

							const nameElement = document.createElement('div');
							nameElement.classList.add('name');
							nameElement.textContent = menuItem[4]; // Изменено на индекс названия блюда в массиве

							const descElement = document.createElement('div');
							descElement.classList.add('desc');
							descElement.textContent = menuItem[5]; // Изменено на индекс описания блюда в массиве

							const butElement = document.createElement('div'); // Создаем блок для кнопки
							butElement.classList.add('but');

							const btnElement = document.createElement('button');
							btnElement.classList.add('btn');
							btnElement.textContent = menuItem[6]; // Изменено на индекс цены блюда в массиве

							// Добавляем созданные элементы в новый элемент .item
							newItem.appendChild(photoElement);
							newItem.appendChild(nameElement);
							newItem.appendChild(descElement);
							// newItem.appendChild(btnElement);
							
							butElement.appendChild(btnElement); // Добавляем кнопку в блок для кнопки
							newItem.appendChild(butElement); // Добавляем блок для кнопки в .item

							const menuItemsContainer = document.getElementById('menuItems');
							menuItemsContainer.appendChild(newItem); // Добавляем новый .item в контейнер меню
						});
					} else {
						console.error('Массив меню пуст или отсутствует.');
					}
				})
			.catch(error => {
				console.error('Ошибка при получении меню:', error);
			});
		}

		// Обработчик события для нажатия на выбранную дату
		const dateElements = document.querySelectorAll('.card');
		dateElements.forEach(dateElement => {
			dateElement.addEventListener('click', function() {
				const dayId = this.id; // Получаем ID выбранной даты (индекс)
				fetchMenu(dayId); // Запрашиваем меню из базы данных по индексу дня
			});
		});

		window.addEventListener('DOMContentLoaded', () => {
			const firstDateElement = document.querySelector('.card'); // Находим первый элемент с классом .card
			if (firstDateElement) {
				firstDateElement.click(); // Вызываем событие click для первой даты
			}
		});

	</script>



</body>
</html>


